<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>BGMI Tournament ‚Ä¢ Register</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0A0A0C;
  --panel:#0b0e17;
  --gold:#FFD700;
  --gold2:#ff9f00;
  --muted:#9aa0b4;
  --radius:18px;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui;}
html,body{
  width:100%;
  height:100%;
  background:radial-gradient(120% 80% at 50% 0%, #121421 0%, #050508 60%, #020204 100%);
  color:#fff;
  overflow:hidden;
}
.app{
  max-width:430px;
  margin:0 auto;
  height:100dvh;
  display:flex;
  flex-direction:column;
  padding:10px;
}

/* Header */
.header{
  position:sticky;top:0;z-index:10;
  padding:10px 12px;
  background:linear-gradient(90deg,#8a6b00,#FFD700,#fff1a8,#FFD700,#8a6b00);
  color:#000;font-weight:900;letter-spacing:.6px;
  box-shadow:0 10px 24px rgba(0,0,0,.6);
  text-align:center;
  font-size:16px;
  border-radius:12px;
  margin-bottom:12px;
}

/* Content */
.content{
  flex:1;
  overflow:auto;
  padding:0 4px 20px;
}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
  border:1px solid rgba(255,215,0,.35);
  border-radius:22px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 14px 32px rgba(0,0,0,.75), inset 0 0 18px rgba(255,215,0,.06);
  backdrop-filter: blur(6px);
  position:relative;
}
.h{font-weight:900;color:var(--gold);margin-bottom:8px;}
.sub{color:var(--muted);font-size:12px;margin-bottom:10px}

/* Rules button inside card */
.rules-btn{
  position:absolute;
  top:12px;
  right:12px;
  padding:6px 10px;
  background:linear-gradient(90deg,var(--gold2),var(--gold));
  border:none;
  border-radius:12px;
  font-size:12px;
  font-weight:700;
  color:#000;
  cursor:pointer;
  box-shadow:0 4px 8px rgba(255,215,0,.5);
}

/* Inputs */
.input,.select{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,215,0,.35);
  background:#06070c;color:#fff;
  outline:none;margin-bottom:10px;
}

/* Buttons */
.btn{
  width:100%;border:none;border-radius:16px;padding:14px 16px;
  font-weight:900;letter-spacing:.6px;color:#000;
  background:linear-gradient(90deg,var(--gold2),var(--gold),#fff1a8,var(--gold));
  box-shadow:0 12px 26px rgba(255,215,0,.55), inset 0 1px 0 #fff;
  cursor:pointer;
}
.btn.secondary{
  background:transparent;color:var(--gold);
  border:1px dashed rgba(255,215,0,.5);
  box-shadow:none;
}

/* QR */
.qr{display:none;margin-top:10px;text-align:center;border:1px dashed rgba(255,215,0,.5);border-radius:16px;padding:12px;}
.qr img{width:170px;height:170px;border-radius:14px;background:#fff}
.note{color:var(--muted);font-size:11px;margin-top:6px}

/* Status */
.ok{color:#22f5c3;font-weight:800}
.err{color:#ff6b6b;font-weight:800}
</style>
</head>
<body>

<div class="app">
  <div class="header">üéØ BGMI Tournament Registration</div>

  <div class="content">
    <!-- Player Details Card -->
    <div class="card">
      <div class="h">üéØ Player Details</div>
      <button class="rules-btn" onclick="window.location.href='rules.html'">üìú Rules</button>
      <input id="name" class="input" placeholder="Player Name" />
      <input id="bgmi" class="input" placeholder="BGMI ID" />
      <input id="phone" class="input" placeholder="Mobile No (10 digits)" />
      <select id="room" class="select">
        <option value="Group A ‚Ä¢ 2:00 PM">Group A ‚Ä¢ 2:00 PM</option>
        <option value="Group B ‚Ä¢ 8:40 PM">Group B ‚Ä¢ 8:40 PM</option>
      </select>
    </div>

    <!-- Payment Card -->
    <div class="card">
      <div class="h">üí≥ Payment (UPI)</div>
      <div class="sub">Scan & pay ‚Çπ20, then enter Txn ID</div>
      <div class="qr" id="qrBox">
        <img id="qrImg" />
        <input id="txn" class="input" placeholder="UPI Transaction ID" style="margin-top:10px"/>
        <div class="note" id="upiNote"></div>
      </div>
      <button class="btn" id="payBtn" onclick="showQR()">Pay ‚Çπ20 & Continue</button>
    </div>

    <!-- Confirm Card -->
    <div class="card">
      <div class="h">‚úÖ Confirm</div>
      <button class="btn secondary" onclick="confirmBooking()">Confirm Booking</button>
      <div id="msg" style="margin-top:8px"></div>
    </div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getDatabase, ref, push, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  authDomain: "incoinpaysliveearning.firebaseapp.com",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning",
  storageBucket: "incoinpaysliveearning.firebasestorage.app",
  messagingSenderId: "971873814750",
  appId: "1:971873814750:web:7418c7da119e4725ed9a4f",
  measurementId: "G-5QXM87ZRH2"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ADMIN_UPI = localStorage.getItem("admin_upi") || "yourupi@bank";
const MAX_PER_ROOM = 25;

function showQR(){
  const data = `upi://pay?pa=${encodeURIComponent(ADMIN_UPI)}&pn=BGMI%20Tournament&am=20&cu=INR`;
  document.getElementById("qrImg").src =
   `https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${encodeURIComponent(data)}`;
  document.getElementById("upiNote").innerText = "Pay to: " + ADMIN_UPI;
  document.getElementById("qrBox").style.display = "block";
  document.getElementById("payBtn").style.display = "none";
}

async function confirmBooking(){
  const nameEl=name.value.trim(), bgmiEl=bgmi.value.trim(), phoneEl=phone.value.trim(), roomEl=room.value, txnEl=txn.value.trim();
  const msg=document.getElementById("msg");
  if(!nameEl||!bgmiEl||phoneEl.length!==10||!txnEl){ msg.innerHTML="<span class='err'>‚ùå Fill all fields</span>"; return;}

  // Check if Txn already exists
  const txnRef = ref(db, 'transactions/' + txnEl);
  const txnSnap = await get(txnRef);
  if(txnSnap.exists()){ msg.innerHTML="<span class='err'>‚ùå Txn ID already used</span>"; return;}

  // Check room limit
  const roomRef = ref(db, 'rooms/' + roomEl.replace(/\s/g,'_'));
  const roomSnap = await get(roomRef);
  const currentUsers = roomSnap.exists() ? Object.keys(roomSnap.val()).length : 0;
  if(currentUsers >= MAX_PER_ROOM){ msg.innerHTML="<span class='err'>‚ùå Group Full</span>"; return;}

  // Save booking
  const userRef = ref(db, 'rooms/' + roomEl.replace(/\s/g,'_') + '/' + phoneEl);
  set(userRef, {name:nameEl,bgmi:bgmiEl,phone:phoneEl,txn:txnEl,time:Date.now()});
  set(ref(db,'transactions/'+txnEl), {phone:phoneEl,room:roomEl,time:Date.now()});

  msg.innerHTML="<span class='ok'>‚úÖ Booking Successful</span>";
}
</script>

</body>
</html>
