<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>BGMI Tournament ‚Ä¢ Register</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0A0A0C;
  --panel:#0b0e17;
  --gold:#FFD700;
  --gold2:#ff9f00;
  --muted:#9aa0b4;
  --glass:rgba(255,255,255,.06);
  --radius:18px;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui;}
html,body{width:100%;height:100%;background:radial-gradient(120% 80% at 50% 0%, #121421 0%, #050508 60%, #020204 100%);color:#fff;overflow:hidden;}
.app{max-width:430px;margin:0 auto;height:100dvh;display:flex;flex-direction:column;}

/* Header */
.header{
  position:sticky;top:0;z-index:10;
  padding:14px 14px 12px;
  background:linear-gradient(90deg,#8a6b00,#FFD700,#fff1a8,#FFD700,#8a6b00);
  color:#000;font-weight:900;letter-spacing:.6px;
  box-shadow:0 10px 24px rgba(0,0,0,.6);
}
.header .sub{font-size:11px;font-weight:700;opacity:.9}

/* Content */
.content{
  flex:1;overflow:auto;padding:12px 12px 90px;
}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
  border:1px solid rgba(255,215,0,.35);
  border-radius:22px;
  padding:14px;margin-bottom:12px;
  box-shadow:0 14px 32px rgba(0,0,0,.75), inset 0 0 18px rgba(255,215,0,.06);
  backdrop-filter: blur(6px);
}
.h{font-weight:900;color:var(--gold);margin-bottom:8px;letter-spacing:.3px}
.sub{color:var(--muted);font-size:12px;margin-bottom:10px}

/* Inputs */
.input, .select{
  width:100%;padding:12px;border-radius:14px;
  border:1px solid rgba(255,215,0,.35);
  background:#06070c;color:#fff;outline:none;margin-bottom:10px;
}
.row{display:grid;grid-template-columns:1fr 1fr;gap:8px}

/* Buttons */
.btn{
  width:100%;border:none;border-radius:16px;padding:14px 16px;
  font-weight:900;letter-spacing:.6px;color:#000;
  background:linear-gradient(90deg,var(--gold2),var(--gold),#fff1a8,var(--gold));
  box-shadow:0 12px 26px rgba(255,215,0,.55), inset 0 1px 0 #fff;
}
.btn.secondary{
  background:transparent;color:var(--gold);
  border:1px dashed rgba(255,215,0,.5);
  box-shadow:none;
}

/* QR */
.qr{
  display:none;margin-top:10px;text-align:center;
  border:1px dashed rgba(255,215,0,.5);border-radius:16px;padding:12px;
}
.qr img{width:180px;height:180px;border-radius:14px;background:#fff}
.note{color:var(--muted);font-size:11px;margin-top:6px}

/* Status */
.ok{color:#22f5c3;font-weight:800}
.err{color:#ff6b6b;font-weight:800}

/* Footer */
.footer{
  position:sticky;bottom:0;z-index:10;
  padding:10px 12px;background:linear-gradient(180deg, rgba(5,6,10,.65), rgba(5,6,10,.95));
  backdrop-filter: blur(6px);
}
</style>
</head>
<body>

<div class="app">
  <div class="header">
    BGMI TOURNAMENT ‚Ä¢ REGISTER
    <div class="sub">Entry ‚Çπ20 ‚Ä¢ Limited slots ‚Ä¢ Mobile-only</div>
  </div>

  <div class="content">
    <div class="card">
      <div class="h">üéØ Player Details</div>
      <input id="name" class="input" placeholder="Player Name" />
      <input id="bgmi" class="input" placeholder="BGMI ID" />
      <input id="phone" class="input" placeholder="Mobile No (10 digits)" />
      <select id="room" class="select">
        <option value="Room 1 ‚Ä¢ 6:00 PM">Room 1 ‚Ä¢ 6:00 PM</option>
        <option value="Room 2 ‚Ä¢ 7:00 PM">Room 2 ‚Ä¢ 7:00 PM</option>
      </select>
    </div>

    <div class="card">
      <div class="h">üí≥ Payment (UPI)</div>
      <div class="sub">Scan & pay ‚Çπ20, then enter Txn ID</div>
      <div class="qr" id="qrBox">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=upi://pay?pa=9142192847@jio&pn=BGMI%20Tournament&am=20&cu=INR" alt="UPI QR"/>
        <input id="txn" class="input" placeholder="UPI Transaction ID" style="margin-top:10px"/>
        <div class="note">Make sure Txn ID is unique</div>
      </div>
      <button class="btn" id="payBtn" onclick="showQR()">Pay ‚Çπ20 & Continue</button>
    </div>

    <div class="card">
      <div class="h">‚úÖ Confirm</div>
      <button class="btn secondary" onclick="confirmBooking()">Confirm Booking</button>
      <div id="msg" style="margin-top:8px"></div>
    </div>
  </div>

  <div class="footer">
    <button class="btn" onclick="location.href='slots.html'">üìã Check Slot List</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// TODO: Replace with your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDsJUtZdIXcsB0w_2MQhMBXxIgbI3ijOvg",
  authDomain: "incoinpaysliveearning.firebaseapp.com",
  databaseURL: "https://incoinpaysliveearning-default-rtdb.firebaseio.com",
  projectId: "incoinpaysliveearning",
  storageBucket: "incoinpaysliveearning.appspot.com",
  messagingSenderId: "971873814750",
  appId: "1:971873814750:web:7418c7da119e4725ed9a4f",
  measurementId: "G-5QXM87ZRH2"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const MAX_PER_ROOM = 25;

function showQR(){
  document.getElementById("qrBox").style.display = "block";
  document.getElementById("payBtn").style.display = "none";
}

// Check room count from Firebase
async function countRoom(room){
  const snapshot = await db.ref('users').orderByChild('room').equalTo(room).once('value');
  return snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
}

// Check if Txn ID already exists
async function txnExists(txn){
  const snapshot = await db.ref('txns/' + txn).once('value');
  return snapshot.exists();
}

async function confirmBooking(){
  const name = document.getElementById("name").value.trim();
  const bgmi = document.getElementById("bgmi").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const room = document.getElementById("room").value;
  const txn = document.getElementById("txn").value.trim();
  const msg = document.getElementById("msg");

  if(!name || !bgmi || phone.length !== 10 || !txn){
    msg.innerHTML = "<span class='err'>‚ùå Fill all fields correctly</span>";
    return;
  }

  if(await txnExists(txn)){
    msg.innerHTML = "<span class='err'>‚ùå This Txn ID already used</span>";
    return;
  }

  const roomCount = await countRoom(room);
  if(roomCount >= MAX_PER_ROOM){
    msg.innerHTML = "<span class='err'>‚ùå Room full</span>";
    return;
  }

  // Add user to Firebase
  const newUserRef = db.ref('users').push();
  await newUserRef.set({
    name, bgmi, phone, room, slot: roomCount + 1
  });

  // Save txn
  await db.ref('txns/' + txn).set({usedBy: phone, timestamp: Date.now()});

  msg.innerHTML = "<span class='ok'>‚úÖ Booking successful! Opening WhatsApp‚Ä¶</span>";

  const text = encodeURIComponent(
    `Hi ${name}! Your BGMI slot is confirmed.\nRoom: ${room}\nBGMI ID: ${bgmi}`
  );
  window.open(`https://wa.me/91${phone}?text=${text}`, "_blank");
}
</script>

</body>
</html>
